name: Build and push Workflow

on:
  workflow_call:
    secrets:
      access_key:
        required: true
      secret_key:
        required: true

jobs:
  build:    
    name: Build Image
    runs-on: ubuntu-latest
    outputs:
      STACK: ${{ steps.set-output-defaults.outputs.environment }}
    defaults:
      run:
        shell: bash
        working-directory: ./

    steps:
      - name: set outputs with default values
        id: set-output-defaults
        run: |
          if [ "${GITHUB_REF#refs/heads/}" == "main" ]; then 
              echo "::set-output name=environment::prod }}" 
          elif [ "${GITHUB_REF#refs/heads/}" == "dev" ]; then 
              echo "::set-output name=environment::dev }}" 
          else [ "${GITHUB_REF#refs/heads/}" == "stage" ]
              echo "::set-output name=environment::stage }}" 
          fi  

 